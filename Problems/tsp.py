import sys
import os
# Add parent directory to Python path so we can import from blindSearch
sys.path.append(os.path.abspath(os.path.join(os.path.dirname(__file__), '..')))



import blindSearch.Configuration.dfs as dfs
import blindSearch.Configuration.bfs as bfs
import blindSearch.Configuration.dfid as dfid


import blindSearch.planning.dfs as dfs_planning
import blindSearch.planning.bfs as bfs_planning
import blindSearch.planning.dfid as dfid_planning

# heuristic search
import heuristic.bfs as bestfs
import localSearch.hillClimbing as hillclimbing
import localSearch.iteratedHillClimbing as iter_hillclimb
import localSearch.tabuSearch as tabusearch
import localSearch.beamSearch as beamsearch


#stochastic search
import Stochastic.randomWalk as randomwalk
import Stochastic.simulatedAnnealing as simulatedannealing
import Stochastic.hillClimbing as stochastichillclimbing


#Genetic Algorithm
import Genetic.tsp as ga_tsp

# ACO
import ACO.aco as aco



'''

graph = [
    [0,   29,  20,  21,  16,  31, 100,  12],
    [29,   0,  15,  29,  28,  40,  72,  21],
    [20,  15,   0,  15,  14,  25,  81,   9],
    [21,  29,  15,   0,   4,  12,  92,  12],
    [16,  28,  14,   4,   0,  16,  95,  10],
    [31,  40,  25,  12,  16,   0,  70,  15],
    [100, 72,  81,  92,  95,  70,   0, 101],
    [12,  21,   9,  12,  10,  15, 101,   0]
]

'''

# best found 2639
graph = [
    [0, 110, 221, 950, 385, 40, 257, 951, 19, 958, 705, 343, 195, 659, 843, 702, 449, 757, 98, 509, 754, 670, 753, 309, 164, 752, 732, 751, 338, 976, 221, 654, 929, 444, 734, 699, 84, 441, 240, 696, 378, 151, 607, 722, 424, 574, 876, 276, 846, 42],
    [110, 0, 621, 714, 726, 173, 19, 581, 650, 683, 672, 515, 437, 468, 422, 627, 820, 927, 170, 82, 641, 808, 216, 86, 588, 326, 230, 644, 420, 362, 983, 493, 477, 253, 805, 186, 425, 768, 735, 510, 633, 541, 222, 593, 299, 839, 798, 134, 950, 313],
    [221, 621, 0, 690, 86, 390, 415, 272, 257, 501, 245, 569, 641, 456, 591, 102, 596, 486, 426, 319, 755, 652, 332, 143, 738, 604, 293, 645, 285, 963, 418, 191, 651, 753, 397, 824, 718, 12, 674, 899, 820, 632, 98, 292, 349, 277, 800, 916, 515, 634],
    [950, 714, 690, 0, 737, 89, 168, 638, 15, 86, 721, 770, 993, 163, 368, 966, 444, 77, 667, 933, 90, 646, 270, 593, 119, 362, 17, 495, 404, 311, 89, 243, 376, 65, 655, 414, 928, 300, 327, 862, 924, 639, 754, 723, 358, 923, 380, 865, 759, 454],
    [385, 726, 86, 737, 0, 212, 821, 967, 862, 869, 649, 835, 123, 231, 385, 283, 242, 620, 327, 739, 148, 241, 70, 587, 436, 285, 730, 469, 879, 595, 463, 885, 771, 553, 854, 751, 916, 98, 130, 819, 53, 597, 227, 65, 295, 828, 624, 170, 668, 454],
    [40, 173, 390, 89, 212, 0, 423, 575, 173, 633, 609, 660, 29, 685, 919, 570, 723, 173, 366, 452, 963, 598, 132, 470, 957, 546, 299, 648, 189, 69, 333, 950, 692, 470, 219, 274, 524, 113, 54, 372, 887, 113, 791, 664, 633, 845, 728, 277, 529, 436],
    [257, 19, 415, 168, 821, 423, 0, 48, 30, 672, 780, 405, 695, 150, 834, 108, 929, 428, 806, 636, 608, 981, 452, 43, 619, 914, 783, 285, 835, 745, 612, 729, 833, 536, 450, 450, 388, 661, 431, 170, 959, 443, 125, 67, 580, 555, 266, 403, 44, 814],
    [951, 581, 272, 638, 967, 575, 48, 0, 499, 433, 961, 206, 519, 91, 707, 981, 590, 512, 744, 269, 692, 652, 459, 960, 386, 29, 712, 159, 289, 542, 460, 185, 989, 159, 195, 425, 253, 548, 625, 312, 386, 113, 482, 734, 454, 520, 49, 285, 454, 431],
    [19, 650, 257, 15, 862, 173, 30, 499, 0, 414, 718, 969, 608, 733, 223, 419, 157, 986, 691, 300, 741, 355, 721, 309, 291, 258, 584, 22, 844, 833, 976, 782, 240, 994, 260, 528, 549, 387, 818, 181, 416, 902, 821, 818, 583, 446, 687, 785, 240, 558],
    [958, 683, 501, 86, 869, 633, 672, 433, 414, 0, 541, 543, 42, 723, 289, 492, 470, 492, 287, 184, 669, 901, 929, 795, 257, 111, 474, 206, 190, 242, 325, 78, 243, 257, 504, 523, 373, 831, 322, 371, 520, 542, 508, 889, 295, 313, 407, 612, 596, 113],
    [705, 672, 245, 721, 649, 609, 780, 961, 718, 541, 0, 120, 96, 247, 632, 269, 959, 912, 151, 76, 431, 764, 555, 889, 917, 495, 545, 22, 606, 752, 924, 807, 991, 41, 193, 255, 181, 648, 68, 245, 698, 905, 379, 313, 147, 112, 898, 331, 877, 540],
    [343, 515, 569, 770, 835, 660, 405, 206, 969, 543, 120, 0, 597, 39, 763, 103, 461, 352, 293, 762, 41, 301, 710, 443, 781, 719, 354, 402, 451, 922, 362, 939, 635, 391, 254, 422, 118, 404, 575, 447, 481, 865, 775, 320, 891, 787, 13, 404, 747, 788],
    [195, 437, 641, 993, 123, 29, 695, 519, 608, 42, 96, 597, 0, 533, 607, 90, 876, 217, 262, 227, 48, 777, 338, 750, 330, 782, 816, 59, 420, 911, 369, 283, 59, 426, 356, 663, 909, 498, 945, 250, 118, 454, 331, 565, 888, 288, 303, 761, 715, 808],
    [659, 468, 456, 163, 231, 685, 150, 91, 733, 723, 247, 39, 533, 0, 746, 89, 618, 916, 237, 945, 42, 892, 418, 148, 191, 984, 245, 626, 54, 979, 944, 984, 183, 281, 983, 16, 567, 452, 225, 91, 72, 322, 938, 534, 54, 1000, 622, 682, 617, 803],
    [843, 422, 591, 368, 385, 919, 834, 707, 223, 289, 632, 763, 607, 746, 0, 855, 500, 506, 188, 530, 785, 857, 360, 872, 634, 732, 854, 666, 659, 732, 568, 712, 484, 125, 362, 566, 323, 153, 432, 190, 291, 983, 856, 244, 775, 898, 218, 881, 920, 369],
    [702, 627, 102, 966, 283, 570, 108, 981, 419, 492, 269, 103, 90, 89, 855, 0, 653, 300, 736, 970, 67, 725, 208, 820, 971, 269, 911, 726, 756, 244, 388, 830, 261, 260, 154, 316, 79, 969, 532, 471, 939, 246, 44, 209, 674, 30, 278, 541, 966, 291],
    [449, 820, 596, 444, 242, 723, 929, 590, 157, 470, 959, 461, 876, 618, 500, 653, 0, 109, 391, 609, 599, 127, 926, 704, 370, 762, 690, 725, 430, 317, 861, 593, 436, 628, 332, 454, 279, 977, 578, 252, 256, 601, 725, 162, 540, 472, 982, 52, 652, 762],
    [757, 927, 486, 77, 620, 173, 428, 512, 986, 492, 912, 352, 217, 916, 506, 300, 109, 0, 166, 717, 895, 805, 145, 288, 462, 925, 502, 107, 238, 871, 531, 203, 496, 328, 815, 758, 608, 140, 288, 653, 621, 965, 593, 78, 292, 113, 927, 629, 498, 604],
    [98, 170, 426, 667, 327, 366, 806, 744, 691, 287, 151, 293, 262, 237, 188, 736, 391, 166, 0, 506, 542, 853, 761, 287, 517, 526, 847, 517, 368, 635, 603, 70, 205, 616, 633, 535, 714, 922, 432, 140, 178, 925, 611, 623, 393, 999, 970, 101, 406, 197],
    [509, 82, 319, 933, 739, 452, 636, 269, 300, 184, 76, 762, 227, 945, 530, 970, 609, 717, 506, 0, 496, 195, 125, 696, 877, 617, 784, 803, 247, 850, 301, 195, 441, 624, 951, 348, 529, 502, 96, 686, 853, 768, 664, 732, 70, 924, 341, 10, 382, 703],
    [754, 641, 755, 90, 148, 963, 608, 692, 741, 669, 431, 41, 48, 42, 785, 67, 599, 895, 542, 496, 0, 127, 233, 787, 231, 429, 39, 582, 878, 40, 652, 141, 518, 766, 409, 848, 771, 954, 684, 388, 891, 996, 524, 593, 81, 33, 655, 348, 591, 781],
    [670, 808, 652, 646, 241, 598, 981, 652, 355, 901, 764, 301, 777, 892, 857, 725, 127, 805, 853, 195, 127, 0, 636, 901, 614, 929, 897, 797, 183, 994, 345, 244, 326, 787, 835, 679, 179, 55, 108, 916, 149, 867, 932, 373, 583, 372, 46, 317, 585, 154],
    [753, 216, 332, 270, 70, 132, 452, 459, 721, 929, 555, 710, 338, 418, 360, 208, 926, 145, 761, 125, 233, 636, 0, 433, 290, 92, 454, 144, 812, 247, 163, 693, 342, 855, 378, 975, 972, 404, 777, 125, 858, 502, 624, 275, 95, 452, 429, 735, 411, 917],
    [309, 86, 143, 593, 587, 470, 43, 960, 309, 795, 889, 443, 750, 148, 872, 820, 704, 288, 287, 696, 787, 901, 433, 0, 954, 808, 309, 235, 500, 552, 571, 493, 257, 811, 235, 84, 612, 850, 448, 158, 44, 125, 528, 564, 771, 878, 326, 561, 694, 275],
    [164, 588, 738, 119, 436, 957, 619, 386, 291, 257, 917, 781, 330, 191, 634, 971, 370, 462, 517, 877, 231, 614, 290, 954, 0, 616, 990, 921, 194, 959, 576, 499, 310, 868, 895, 401, 415, 254, 281, 28, 56, 64, 286, 840, 904, 431, 380, 321, 774, 26],
    [752, 326, 604, 362, 285, 546, 914, 29, 258, 111, 495, 719, 782, 984, 732, 269, 762, 925, 526, 617, 429, 929, 92, 808, 616, 0, 157, 289, 329, 789, 281, 687, 809, 227, 808, 780, 999, 778, 972, 230, 533, 535, 705, 378, 610, 97, 739, 95, 870, 82],
    [732, 230, 293, 17, 730, 299, 783, 712, 584, 474, 545, 354, 816, 245, 854, 911, 690, 502, 847, 784, 39, 897, 454, 309, 990, 157, 0, 882, 833, 842, 277, 944, 951, 643, 819, 445, 87, 419, 292, 442, 706, 848, 560, 463, 395, 806, 359, 661, 152, 575],
    [751, 644, 645, 495, 469, 648, 285, 159, 22, 206, 22, 402, 59, 626, 666, 726, 725, 107, 517, 803, 582, 797, 144, 235, 921, 289, 882, 0, 289, 873, 940, 759, 449, 343, 390, 40, 23, 784, 494, 75, 521, 600, 700, 208, 277, 822, 19, 91, 986, 151],
    [338, 420, 285, 404, 879, 189, 835, 289, 844, 190, 606, 451, 420, 54, 659, 756, 430, 238, 368, 247, 878, 183, 812, 500, 194, 329, 833, 289, 0, 170, 55, 705, 36, 523, 23, 109, 12, 668, 831, 397, 978, 157, 592, 191, 388, 694, 450, 102, 1000, 39],
    [976, 362, 963, 311, 595, 69, 745, 542, 833, 242, 752, 922, 911, 979, 732, 244, 317, 871, 635, 850, 40, 994, 247, 552, 959, 789, 842, 873, 170, 0, 377, 519, 34, 51, 458, 618, 569, 398, 884, 967, 778, 391, 946, 400, 94, 311, 454, 151, 766, 892],
    [221, 983, 418, 89, 463, 333, 612, 460, 976, 325, 924, 362, 369, 944, 568, 388, 861, 531, 603, 301, 652, 345, 163, 571, 576, 281, 277, 940, 55, 377, 0, 316, 93, 181, 966, 928, 21, 708, 371, 374, 485, 454, 908, 832, 186, 116, 28, 52, 836, 715],
    [654, 493, 191, 243, 885, 950, 729, 185, 782, 78, 807, 939, 283, 984, 712, 830, 593, 203, 70, 195, 141, 244, 693, 493, 499, 687, 944, 759, 705, 519, 316, 0, 926, 942, 724, 335, 468, 231, 752, 495, 793, 374, 657, 729, 344, 178, 383, 142, 494, 590],
    [929, 477, 651, 376, 771, 692, 833, 989, 240, 243, 991, 635, 59, 183, 484, 261, 436, 496, 205, 441, 518, 326, 342, 257, 310, 809, 951, 449, 36, 34, 93, 926, 0, 436, 179, 852, 353, 913, 90, 173, 110, 188, 75, 730, 139, 482, 184, 829, 142, 770],
    [444, 253, 753, 65, 553, 470, 536, 159, 994, 257, 41, 391, 426, 281, 125, 260, 628, 328, 616, 624, 766, 787, 855, 811, 868, 227, 643, 343, 523, 51, 181, 942, 436, 0, 152, 947, 176, 522, 42, 676, 168, 26, 990, 472, 898, 11, 508, 627, 968, 328],
    [734, 805, 397, 655, 854, 219, 450, 195, 260, 504, 193, 254, 356, 983, 362, 154, 332, 815, 633, 951, 409, 835, 378, 235, 895, 808, 819, 390, 23, 458, 966, 724, 179, 152, 0, 566, 255, 250, 132, 256, 846, 138, 842, 582, 415, 947, 401, 407, 99, 386],
    [699, 186, 824, 414, 751, 274, 450, 425, 528, 523, 255, 422, 663, 16, 566, 316, 454, 758, 535, 348, 848, 679, 975, 84, 401, 780, 445, 40, 109, 618, 928, 335, 852, 947, 566, 0, 887, 441, 493, 586, 283, 857, 877, 451, 742, 345, 124, 869, 103, 286],
    [84, 425, 718, 928, 916, 524, 388, 253, 549, 373, 181, 118, 909, 567, 323, 79, 279, 608, 714, 529, 771, 179, 972, 612, 415, 999, 87, 23, 12, 569, 21, 468, 353, 176, 255, 887, 0, 184, 907, 443, 522, 98, 326, 636, 13, 757, 199, 735, 807, 931],
    [441, 768, 12, 300, 98, 113, 661, 548, 387, 831, 648, 404, 498, 452, 153, 969, 977, 140, 922, 502, 954, 55, 404, 850, 254, 778, 419, 784, 668, 398, 708, 231, 913, 522, 250, 441, 184, 0, 236, 978, 838, 869, 61, 72, 647, 746, 946, 809, 298, 416],
    [240, 735, 674, 327, 130, 54, 431, 625, 818, 322, 68, 575, 945, 225, 432, 532, 578, 288, 432, 96, 684, 108, 777, 448, 281, 972, 292, 494, 831, 884, 371, 752, 90, 42, 132, 493, 907, 236, 0, 228, 127, 369, 999, 248, 456, 17, 467, 188, 500, 880],
    [696, 510, 899, 862, 819, 372, 170, 312, 181, 371, 245, 447, 250, 91, 190, 471, 252, 653, 140, 686, 388, 916, 125, 158, 28, 230, 442, 75, 397, 967, 374, 495, 173, 676, 256, 586, 443, 978, 228, 0, 49, 688, 504, 13, 659, 729, 77, 584, 14, 791],
    [378, 633, 820, 924, 53, 887, 959, 386, 416, 520, 698, 481, 118, 72, 291, 939, 256, 621, 178, 853, 891, 149, 858, 44, 56, 533, 706, 521, 978, 778, 485, 793, 110, 168, 846, 283, 522, 838, 127, 49, 0, 358, 423, 825, 688, 543, 741, 408, 936, 729],
    [151, 541, 632, 639, 597, 113, 443, 113, 902, 542, 905, 865, 454, 322, 983, 246, 601, 965, 925, 768, 996, 867, 502, 125, 64, 535, 848, 600, 157, 391, 454, 374, 188, 26, 138, 857, 98, 869, 369, 688, 358, 0, 24, 675, 703, 604, 180, 306, 771, 662],
    [607, 222, 98, 754, 227, 791, 125, 482, 821, 508, 379, 775, 331, 938, 856, 44, 725, 593, 611, 664, 524, 932, 624, 528, 286, 705, 560, 700, 592, 946, 908, 657, 75, 990, 842, 877, 326, 61, 999, 504, 423, 24, 0, 53, 915, 93, 687, 660, 97, 232],
    [722, 593, 292, 723, 65, 664, 67, 734, 818, 889, 313, 320, 565, 534, 244, 209, 162, 78, 623, 732, 593, 373, 275, 564, 840, 378, 463, 208, 191, 400, 832, 729, 730, 472, 582, 451, 636, 72, 248, 13, 825, 675, 53, 0, 791, 584, 646, 491, 975, 856],
    [424, 299, 349, 358, 295, 633, 580, 454, 583, 295, 147, 891, 888, 54, 775, 674, 540, 292, 393, 70, 81, 583, 95, 771, 904, 610, 395, 277, 388, 94, 186, 344, 139, 898, 415, 742, 13, 647, 456, 659, 688, 703, 915, 791, 0, 699, 379, 30, 434, 75],
    [574, 839, 277, 923, 828, 845, 555, 520, 446, 313, 112, 787, 288, 1000, 898, 30, 472, 113, 999, 924, 33, 372, 452, 878, 431, 97, 806, 822, 694, 311, 116, 178, 482, 11, 947, 345, 757, 746, 17, 729, 543, 604, 93, 584, 699, 0, 477, 449, 655, 791],
    [876, 798, 800, 380, 624, 728, 266, 49, 687, 407, 898, 13, 303, 622, 218, 278, 982, 927, 970, 341, 655, 46, 429, 326, 380, 739, 359, 19, 450, 454, 28, 383, 184, 508, 401, 124, 199, 946, 467, 77, 741, 180, 687, 646, 379, 477, 0, 150, 308, 327],
    [276, 134, 916, 865, 170, 277, 403, 285, 785, 612, 331, 404, 761, 682, 881, 541, 52, 629, 101, 10, 348, 317, 735, 561, 321, 95, 661, 91, 102, 151, 52, 142, 829, 627, 407, 869, 735, 809, 188, 584, 408, 306, 660, 491, 30, 449, 150, 0, 356, 512],
    [846, 950, 515, 759, 668, 529, 44, 454, 240, 596, 877, 747, 715, 617, 920, 966, 652, 498, 406, 382, 591, 585, 411, 694, 774, 870, 152, 986, 1000, 766, 836, 494, 142, 968, 99, 103, 807, 298, 500, 14, 936, 771, 97, 975, 434, 655, 308, 356, 0, 545],
    [42, 313, 634, 454, 454, 436, 814, 431, 558, 113, 540, 788, 808, 803, 369, 291, 762, 604, 197, 703, 781, 154, 917, 275, 26, 82, 575, 151, 39, 892, 715, 590, 770, 328, 386, 286, 931, 416, 880, 791, 729, 662, 232, 856, 75, 791, 327, 512, 545, 0],
]




# represents a start state (one of the solution) of travelling salesman problem
start_node = [i+1 for i in range(len(graph))] 

def movegen(node):
    childerens=[]
    for i in range(1,len(node)-1):
        for j in range(i+1,len(node)):
            new_node=node[:i]+node[i:j+1][::-1]+node[j+1:]
            childerens.append(new_node)
    return childerens

def heuristic(node):
    cost=0
    for i in range(len(node)-1):
        cost+=graph[node[i]-1][node[i+1]-1]
    cost+=graph[node[-1]-1][node[0]-1]
    return cost

def state_generator():
    import random
    node=start_node[1:]
    random.shuffle(node)
    node=[start_node[0]]+node
    return node


#Heuristic Search -Local Search
# solution=hillclimbing.hillClimbing(start_node,movegen,heuristic)

# solution=iter_hillclimb.iteratedHillClimbing(movegen,heuristic,state_generator,50)

# solution=tabusearch.tabuSearch(start_node,movegen,heuristic,50)
# solution=beamsearch.beamSearch(start_node,movegen,heuristic,5,200)



#stochastic Local Search
# solution=randomwalk.random_walk(start_node,movegen,heuristic,10000)
# solution=simulatedannealing.simulated_annealing(start_node,movegen,heuristic,1000,100,0.995)
# solution=stochastichillclimbing.stochastic_hill_climbing(start_node,movegen,heuristic,1000,0.4)


#Genetic Algorithm
solution=ga_tsp.genetic_algorithm(start_node, population=10, heuristic=heuristic, generations=1000, mutation_rate=0.2, k=2)


#ACO

# solution=aco.aco(distance_matrix=graph, num_ants=20, max_iterations=1000, alpha=2.0, beta=2.0, evaporation_rate=0.3, initial_pheromone=1.0)



if not solution:
    print("No solution found")
else:
    print(f"\nSolution: {solution}  \n")
    for i in range(len(solution)):
        print(f"{solution[i]} -> {solution[(i+1)%len(solution)]}  Cost: {graph[solution[i]-1][solution[(i+1)%len(solution)]-1]}")
    print(f"Total Cost: {heuristic(solution)}")